params.executor = 'local'

process {
    executor = 'local'
    debug = true
    cpus = 8
    memory = '32 GB'
    containerOptions = "--bind \$HOME:\$HOME"

    // change max forks for specific processes to allow multiple forks
    withName: preprocessing {
        maxForks = 1
    }
    withName: spikesort_kilosort4 {
        maxForks = 1
        containerOptions = '--nv'
    }
    withName: spikesort_kilosort25 {
        maxForks = 1
        containerOptions = '--nv'
    }
    withName: spikesort_spykingcircus2 {
        maxForks = 1
    }
}

apptainer {
    enabled = true
    autoMounts = true
    platform = 'linux/amd64'
    envWhitelist = ['NUMBA_CACHE_DISABLE', 'NUMBA_CACHE_DIR']
}

dag {
    enabled = true
    file = RESULTS_PATH + '/nextflow/dag.html'
    overwrite = true
}

report {
    enabled = true
    file = RESULTS_PATH + '/nextflow/report.html'
    overwrite = true
}

timeline {
    enabled = true
    file = RESULTS_PATH + '/nextflow/timeline.html'
    overwrite = true
}

trace {
    enabled = true
    file = RESULTS_PATH + '/nextflow/trace.txt'
    overwrite = true
}
